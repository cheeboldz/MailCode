/// <reference types="node" />
import { EventEmitter } from 'events';
import { api } from '@replit/protocol';
import { Channel } from './channel';
declare enum ConnectionState {
    CONNECTING = 0,
    CONNECTED = 1,
    DISCONNECTED = 2
}
interface UrlOptions {
    secure: boolean;
    host: string;
    port: string;
}
interface TxRx {
    direction: 'in' | 'out';
    cmd: api.Command;
}
declare type DebugLog = {
    type: 'breadcrumb';
    message: string;
    data?: unknown;
} | {
    type: 'log';
    log: TxRx;
} | {
    type: 'ping';
    latency: number;
};
declare type DebugFunc = (log: DebugLog) => void;
interface ConnectOptions {
    token: string;
    urlOptions?: UrlOptions;
    polling?: boolean;
    timeout?: number | null;
    WebSocketClass?: typeof WebSocket;
}
export declare class Client extends EventEmitter {
    connectionState: ConnectionState;
    private token;
    private ws;
    private channels;
    private debug;
    private didConnect;
    static getConnectionStr(token: string, urlOptions: UrlOptions): string;
    constructor(debug?: DebugFunc);
    isConnected: () => boolean;
    connect: (options: ConnectOptions) => Promise<void>;
    openChannel: ({ name, service, action, }: {
        name?: string | undefined;
        service: string;
        action?: api.OpenChannel.Action | undefined;
    }) => Channel;
    close: () => void;
    getChannel(id: number): Channel;
    getToken(): string | null;
    setDebugFunc(debugFunc: DebugFunc): void;
    startPing: () => void;
    private send;
    private onSocketMessage;
    private handleOpenChanRes;
    private handleCloseChannel;
    private onClose;
    private cleanupSocket;
    private tryConnect;
}
declare function close(c: {
    closeEvent?: CloseEvent;
    expected: boolean;
}): void;
export declare interface Client extends EventEmitter {
    on(event: 'close', listener: typeof close): this;
    addListener(event: 'close', listener: typeof close): this;
    once(event: 'close', listener: typeof close): this;
    prependListener(event: 'close', listener: typeof close): this;
    prependOnceListener(event: 'close', listener: typeof close): this;
    off(event: 'close', listener: typeof close): this;
    removeListener(event: 'close', listener: typeof close): this;
    emit(event: 'close', ...args: Parameters<typeof close>): boolean;
    removeAllListeners(event?: 'close'): this;
    eventNames(): Array<'close'>;
}
export {};
